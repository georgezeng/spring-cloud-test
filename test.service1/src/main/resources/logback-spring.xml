<?xml version="1.0" encoding="UTF-8"?>
<configuration>
<include
		resource="org/springframework/boot/logging/logback/base.xml" />
	<springProfile name="dev">
		<property name="envTier" value="dev"/>
	</springProfile>
	
	<springProfile name="uat">
		<property name="envTier" value="uat"/>
	</springProfile>
	
	<springProfile name="prod">
		<property name="envTier" value="prod"/>
	</springProfile>
	
	<springProfile name="server">
		<springProperty scope="context" name="springAppName"
			source="spring.application.name" />
		<appender name="KAFKA"
			class="com.github.danielwegener.logback.kafka.KafkaAppender">
			<encoder
				class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
				<providers>
				<!-- 
					<timestamp>
						<timeZone>UTC</timeZone>
					</timestamp>
					-->
					<pattern>
							{
								"@level": "%level",
								"service": "${springAppName}",
								"host": "${HOSTNAME}",
								"env": "${envTier}",
								"trace": "%X{X-B3-TraceId}",
								"span": "%X{X-B3-SpanId}",
								"parent": "%X{X-B3-ParentSpanId}",
								"exportable": "%X{X-Span-Export}",
								"pid": "${PID}",
								"thread": "%thread",
								"class": "%logger{40}",
								"fullClass": "%logger",
								"message": "%message"
							}
					</pattern>
				</providers>
			</encoder>
			<topic>logstash</topic>
			<keyingStrategy
				class="com.github.danielwegener.logback.kafka.keying.HostNameKeyingStrategy" />
			<deliveryStrategy
				class="com.github.danielwegener.logback.kafka.delivery.AsynchronousDeliveryStrategy" />

			<!-- Optional parameter to use a fixed partition -->
			<!-- <partition>0</partition> -->

			<!-- Optional parameter to include log timestamps into the kafka message -->
			<!-- <appendTimestamp>true</appendTimestamp> -->

			<!-- each <producerConfig> translates to regular kafka-client config (format: 
				key=value) -->
			<!-- producer configs are documented here: https://kafka.apache.org/documentation.html#newproducerconfigs -->
			<!-- bootstrap.servers is the only mandatory producerConfig -->
			<producerConfig>bootstrap.servers=elkserver:9092</producerConfig>

			<!-- this is the fallback appender if kafka is not available. -->
			<!-- <appender-ref ref="CONSOLE" /> -->
		</appender>
		
		<root level="info">
			<appender-ref ref="KAFKA" />
		</root>
	</springProfile>
</configuration>